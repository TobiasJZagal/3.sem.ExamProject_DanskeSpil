<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Document</title>
  </head>
  <body>
    <style>
      .container {
        display: grid;
        max-width: 1000px;
        grid-gap: 1em;
        grid-template-columns: 1fr 1fr 1fr;
      }
      .content {
        display: grid;
        grid-template: 1fr 1fr 1fr 20px/1fr 1fr 1fr;
        height: 300px;
        width: 300px;

        padding: 1em;
        background-color: rgb(238, 238, 108);
      }
      .name {
        grid-area: 1/1/1/4;
      }
      .email {
        grid-area: 2/1/4/4;
      }
      .deleteButton {
        grid-area: 4/2/4/4;
      }

      .artist {
        background-color: rgb(238, 238, 108);
        height: 150px;
        width: 300px;
        margin-bottom: 2em;
        display: grid;
        grid-template: 1fr 1fr 1fr/1fr 1fr;
      }

      .formDescription {
        grid-area: 3/1/3/1;
      }

      .formTask {
        grid-area: 2/1/2/1;
      }

      .formH1 {
        grid-area: 1/1/1/3;
      }

      .formSumit {
        grid-area: 3/2/3/2;
      }
    </style>
    <form name="artist" class="artist">
      <h1 class="formH1">Create new task</h1>
      <label class="formTask">
        <input type="text" name="name" placeholder="Task name" />
      </label>
      <label class="formDescription">
        <input type="email" name="email" placeholder="Task description" />
      </label>
      <label class="formSumit">
        <input type="submit" value="Submit" name="submit" />
      </label>
    </form>
    <div class="container"></div>

    <template id="temp">
      <div class="content">
        <h2 class="name"></h2>
        <p class="email"></p>
        <button class="deleteButton">Task Done</button>
      </div>
    </template>

    <script>
      const media = "https://music-6420.restdb.io/media";
      let biglist;
      const form = document.querySelector("form");
      const data = {
        Name: "input name",
        Email: "description of task"
      };
      const postData = JSON.stringify(data);

      window.addEventListener("DOMContentLoaded", init);

      function init() {
        form.elements.submit.disabled = true;
        get();
      }

      function post(NewPerson) {
        fetch("https://music-6420.restdb.io/rest/person-info", {
          method: "post",
          headers: {
            "Content-Type": "application/json; charset=utf-8",
            "x-apikey": "5c7ce843cac6621685acbaaa",
            "cache-control": "no-cache"
          },
          body: JSON.stringify(NewPerson)
        })
          .then(res => res.json())
          .then(data => {
            console.log(data.list[0].message[0]);
            if (data.status) {
              console.log("ERROR");
            } else {
              showcard(data);
            }
          });
      }

      function get() {
        fetch("https://music-6420.restdb.io/rest/person-info", {
          method: "get",
          headers: {
            "Content-Type": "application/json; charset=utf-8",
            "x-apikey": "5c7ce843cac6621685acbaaa",
            "cache-control": "no-cache"
          }
        })
          .then(res => res.json())
          .then(json => {
            biglist = json;
            console.table(json);
            json.forEach(showcard);
          });
      }

      function showcard(item) {
        let clone = document.querySelector("#temp").cloneNode(true).content;

        clone.querySelector(".name").innerHTML = item.Name;
        clone.querySelector(".email").textContent = item.Email;
        document.querySelector(".container").appendChild(clone);
      }

      form.elements.email.addEventListener("keyup", () => {
        if (
          form.elements.email.validity.valid &&
          form.elements.email.value !== ""
        ) {
          form.elements.submit.disabled = false;
        } else {
          form.elements.submit.disabled = true;
        }
      });

      form.addEventListener("submit", e => {
        e.preventDefault();
        //form.elements.submit.disabled = true;

        const inputData = {
          Name: form.elements.name.value,
          Email: form.elements.email.value
        };

        for (let i = 0; i < biglist.length; i++) {
          if (inputData.Email == biglist[i].Email) {
            console.log(biglist[i].Email);
            sayHello(biglist[i].Name);
            break;
          } else if (
            inputData.Email !== biglist[i].Email &&
            i == biglist.length - 1
          ) {
            post(inputData);
            console.log(inputData);
            console.log("user created");
          }
        }
      });

      function sayHello(name) {
        console.log(`hello ${name}`);
      }
    </script>
  </body>
</html>
